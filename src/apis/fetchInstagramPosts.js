// fetchInstagramPosts.js

import fs from "fs";

// 여기에 주신 post_id 리스트를 그대로 붙여넣으면 됨
const postIds = [
  3248922379520810146,
  2830613976089738778,
  2792959853388593170,
  3646116498294220391,
  3614795672932898993,
  2830410550947416245,
  3240716885178551544,
  3579169753608340111,
  3571402368570634073,
  3613398896996966916,
  3251868554421119351,
  3121998733250937460,
  3538065136556453865,
  3249772116644100101,
  3107386650867090729,
  3612629873253594872,
  3194948337220402283,
  3753979662763513880,
  3466991742984195273,
  3707717789841535514,
  2630544933712064785,
  3538558684638268335,
  3615393499914419450,
  3063886917939147724,
  3066764287708631001,
  3131324173190980430,
  3084325293203402701,
  2869104897304102609,
  3119857872411410957,
  2632679433354774985,
  3582688410450217779,
  3105255208444950446,
  3484437291936972854,
  3111103149367363029,
  2884335412634298960,
  3523304769026892970,
  3687999894842532535,
  3651119127028230321,
  3344492720782992888,
  2569783067037594032,
  3523529378577804408,
  3122094578692688208,
  2781547441510768515,
  3117071970385920494,
  3291638491052589912,
  2566257484243416177,
  3229386726051188786,
  3115543564894546285,
  3660998170538471463,
  3161467982684699619,
  3702636329363249330,
  2610398909942617567,
  3200506699544857871,  
  3590088400101306038,
  3609639065614272685,
  3557541333931151599,
  3377023328051781816,
  3448273991787949249,
  2706649134326497624,
  3617013669366302375,
  3696124255743719527,
  3732030529672432476,
  3744519824078006438,
  2929133097565434220,
  3364611110928787609,
  3709879722483634107,
  3483099777073338308,
  3640617687598446301,
  3513845132250530240,
  3448287124640492418,
  3373163337771587019,
  3752650777090546510,
  3292533120988220264,
  2864862871469349763,
  3587428101524977584,
  3565979155085382288,
  3369079579861717843,
  3126430667140294399,
  3618278491751622347,
  3676594961213921606,
  3041179899705921849,
  2890251190084435636,
  3750138523346428047,
  3605546973019050250,
  3633052624409744744,
  2889386200102979936,
  3044492852100639718,
  3560460938402675733,
  2830775807077985914,
  3076703598617890709,
  3042902597653400599,
  3049495385236863448,
  3230058448090985829,
  3369061503252122081,
  3000960255183716156,
  3663423786088550548,
  3125718104750173149,
  2829948998100319104,
  3667255948557956737,
  3243089553483334181,
  3078532725976426486,
  3200477907536520037,
  3081544525520279511,
  3073492445429634996,
  3246606551350961863,
  3178020493932674384,
  3636686499526613792,
  3696904898091496870,
  3696903662432851216,
  3570014733189245598,
  3205637207304082691,
  3237583243190712417,
  3574877560097821472,
  3205644317647639358,
  3531468844097610205,
  3369380427656602697,
  3689421394632657925,
  3265662451913776209,
  3215628905775743591,
  3212727854437426008,
  3639290508754908054,
  3639273323323996979,
  3580645168250437896,
  3552437233863230583,
  3531526884690421731,
  3531331272089973865,
  3519738075006052694,
  3500886398056268383,
  3500116572767835445,
  3500114529957258769,
  3483491133225710595,
  3447997712679977689,
  3149516598750924548,
  3229886907114414620,
  3200451589921882750,
  3653961756712942504,
  3514996272585406326,
  3068359942850695543,
  2986474501809819251
];

// API 호출 함수
async function fetchPost(postId) {
  const url = `https://storika-waddle.vercel.app/instagram-posts/${postId}`;

  try {
    const res = await fetch(url, {
      method: "GET",
      headers: { accept: "*/*" }
    });

    if (!res.ok) {
      throw new Error(`HTTP ${res.status}`);
    }

    const json = await res.json();
    return { success: true, postId, data: json };
  } catch (err) {
    return { success: false, postId, error: err.message };
  }
}

// 전체 실행
async function main() {
  console.log(`총 ${postIds.length}개 postId 요청 시작...`);

  const results = [];
  const errors = [];

  // 병렬 요청은 서버 부담될 수 있어서 1개씩 순차 처리
  for (const postId of postIds) {
    console.log(`요청 중: ${postId}`);

    const result = await fetchPost(postId);

    if (result.success) {
      results.push(result);
    } else {
      errors.push(result);
    }
  }

  // 결과 저장
  fs.writeFileSync("postResults.json", JSON.stringify(results, null, 2));
  fs.writeFileSync("postErrors.json", JSON.stringify(errors, null, 2));

  console.log("완료!");
  console.log(`성공: ${results.length}개`);
  console.log(`실패: ${errors.length}개`);
  console.log("postResults.json, postErrors.json 파일이 생성되었습니다.");
}

main();

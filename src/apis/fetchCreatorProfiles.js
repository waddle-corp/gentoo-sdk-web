// fetchInstagramPosts.js

import fs from "fs";

// 여기에 주신 post_id 리스트를 그대로 붙여넣으면 됨
const profiletIds = [
4185958219,
631019071,
1419052794,
29675291527,
51156351031,
4204189249,
1745181543,
1830973190,
511156091,
51156351031,
248230143,
1745181543,
6653103653,
248230143,
1129958350,
3410219252,
5627228584,
623930292,
67017489050,
1375652441,
1001668781,
1417653531,
1450328978,
1830973190,
365274149,
1392623478,
1576554790,
2213297084,
424712489,
424712489,
327434019,
424712489,
65129829465,
661558376,
1029283762,
47795455777,
64198712028,
2200660266,
8980510719,
1944604404,
47795455777,
1799766967,
4517069564,
1471620949,
4153174314,
1487639712,
1799766967,
1291856730,
5627228584,
221825795,
1582087559,
185395244,
55467067661,
2415710797,
51326641831,
57698688120,
6354745158,
1206593416,
1029283762,
2809627419,
6305425682,
1311237525,
1687537642,
48355748048,
6909432138,
64528575772,
68094571124,
64528575772,
2082648667,
1206593416,
6909432138,
9873585799,
26762874988,
237051020,
623930292,
40911308217,
587512029,
6810062165,
8240122701,
3134752572,
1701108381,
237051020,
74814820344,
70328973480,
1396086952,
237051020,
1701108381,
1406799691,
512922658,
1701108381,
1701108381,
1701108381,
50734707093,
1604925437,
282897542,
57404402463,
50211374,
6005843060,
604373925,
1471620949,
1701108381,
7151471269,
46207219383,
1701108381,
50211374,
57999829292,
2947952600,
75051059710,
75051059710,
52599313586,
1122118606,
55467067661,
1503126996,
1122118606,
1688634219,
28198682863,
611660441,
496749513,
230913756,
230913756,
36598632567,
36598632567,
1666466605,
1666466605,
68843432529,
56237084076,
56237084076,
56237084076,
1666466605,
1666466605,
56237084076,
56237084076,
230913756,
230913756,
55467067661,
7176132713,
70906531215,
53145471828,
230913756,
];

// API 호출 함수
async function fetchProfiles(profileId) {
  const url = `https://storika-waddle.vercel.app/instagram-profiles/${profileId}`;

  try {
    const res = await fetch(url, {
      method: "GET",
      headers: { accept: "*/*" }
    });

    if (!res.ok) {
      throw new Error(`HTTP ${res.status}`);
    }

    const json = await res.json();
    return { success: true, profileId, data: json };
  } catch (err) {
    return { success: false, profileId, error: err.message };
  }
}

// 전체 실행
async function main() {
  console.log(`총 ${profiletIds.length}개 profileId 요청 시작...`);

  const results = [];
  const errors = [];

  // 병렬 요청은 서버 부담될 수 있어서 1개씩 순차 처리
  for (const profileId of profiletIds) {
    console.log(`요청 중: ${profileId}`);

    const result = await fetchProfiles(profileId);

    if (result.success) {
      results.push(result);
    } else {
      errors.push(result);
    }
  }

  // 결과 저장
  fs.writeFileSync("profileResults.json", JSON.stringify(results, null, 2));
  fs.writeFileSync("profileErrors.json", JSON.stringify(errors, null, 2));

  console.log("완료!");
  console.log(`성공: ${results.length}개`);
  console.log(`실패: ${errors.length}개`);
  console.log("profileResults.json, profileErrors.json 파일이 생성되었습니다.");
}

main();

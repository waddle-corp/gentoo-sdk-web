!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["gentoo-logger"]=t():e["gentoo-logger"]=t()}(self,(()=>(()=>{"use strict";async function e(e,t={},o={}){const i={event:e,timestamp:Date.now(),...t,...o};navigator.sendBeacon("https://tracking.gentooai.com/api/v1/beacon/track",JSON.stringify(i))}class t{constructor(t){null===window.__GentooLoggerInited||void 0===window.__GentooLoggerInited?(this.partnerType=t.partnerType||"gentoo",this.gentooSessionData=JSON.parse(sessionStorage.getItem("gentoo"))||{},this.chatUserId=this.gentooSessionData?.cuid||null,this.displayLocation,this.isMobileDevice=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),this.isInitialized=!1,this.itemId=this.getProductNo()?.productNo,this.categoryId=this.getProductNo()?.categoryNo,this.searchKeyword=this.getSearchKeyword(),this.cafe24UserId=null,this.cafe24MemberId=null,this.cafe24GuestId=null,this.sessionId=this.gentooSessionData?.sessionId||`sess-${Date.now()}-${Math.random().toString(36).substring(2,10)}`,this.gentooSessionData?.sessionId||(this.gentooSessionData.sessionId=this.sessionId,sessionStorage.setItem("gentoo",JSON.stringify(this.gentooSessionData))),this.cafe24ClientId="QfNlFJBPD6mXVWkE8MybWD",this.cafe24Version="2024-09-01",this.bootPromise=new Promise(((t,o)=>{(t=>{this.cafe24API=t,this.getPartnerId(t.MALL_ID).then((e=>(this.partnerId=e,new Promise(((e,o)=>{t.getCustomerIDInfo(((t,i)=>{t?(console.error(`Error while calling cafe24 getCustomerIDInfo api: ${t}`),o(t)):e(i)}))}))))).then((e=>(e.id.member_id?(this.cafe24UserId=e.id.member_id,this.cafe24MemberId=e.id.member_id):(this.cafe24UserId=e.id.guest_id,this.cafe24GuestId=e.id.guest_id),async function(e,t="",o,i){const n=e&&"null"!==e?String(e):Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),s={externalKey:String(o),userToken:n,udid:String(t),chatUserId:i?String(i):null};try{const e="https://api.gentooai.com/chat/api/v1/user",t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});return(await t.json()).chatUserId}catch(e){console.error(`Error while calling postChatUserId API: ${e}`)}}(this.cafe24UserId,"",this.partnerId,this.chatUserId)))).then((t=>{this.chatUserId=t,this.gentooSessionData.cuid=t,sessionStorage.setItem("gentoo",JSON.stringify(this.gentooSessionData)),this.basicPayload={sessionId:this.sessionId,externalKey:this.partnerId,chatUserId:this.chatUserId,userId:this.cafe24MemberId,anonymousId:this.cafe24GuestId,displayLocation:this.displayLocation,pageLocation:window.location.href,itemId:this.itemId,categoryId:this.categoryId};const o=document.referrer;o&&!o.includes(window.location.host)?e("PageTransition",this.basicPayload,{referrerOrigin:o}):this.searchKeyword?e("PageTransition",this.basicPayload,{searchKeyword:this.searchKeyword}):e("PageTransition",this.basicPayload),window.GentooLogListener={log:t=>{"floatingEvent"===t.type&&e(t.event,this.basicPayload,{floatingMessage:t.floatingMessage}),"healthCheck"===t.type&&e(t.event,this.basicPayload,{connectionId:t.connectionId})}}})).catch((e=>{console.error("Initialization error:",e),o(e)}))})(CAFE24API.init({client_id:this.cafe24ClientId,version:this.cafe24Version})),(()=>{const t=function(e,t=1e3){let o=0;return(...i)=>{const n=Date.now();n-o>=t&&(o=n,e(...i))}}((()=>{const t=window.scrollY||document.documentElement.scrollTop;e("Scroll",this.basicPayload,{scrollTop:t,documentHeight:document.documentElement.scrollHeight,viewportHeight:window.innerHeight,scrollPercentage:(t/(document.documentElement.scrollHeight-window.innerHeight)*100).toFixed(1)})}));window.addEventListener("scroll",t,{passive:!0}),window.GentooCleanup=()=>{window.removeEventListener("scroll",t)}})()})),window.__GentooLoggerInited="created"):console.warn("GentooLogger already exists in the document, skipping initialization.")}async init(){if(null===window.__GentooLoggerInited||void 0===window.__GentooLoggerInited){try{if(await this.bootPromise,this.isInitialized)return void console.warn("GentooLogger is already initialized");if(!this.chatUserId)throw new Error("Required data not yet loaded");this.isInitialized=!0}catch(e){throw console.error("Failed to initialize:",e),e}window.__GentooLoggerInited="init"}else console.warn("GentooIO init called twice, skipping second call.")}async logEvent(e){try{const t={eventCategory:String(e.eventCategory),chatUserId:String(e.chatUserId),partnerId:String(e.partnerId),channelId:this.isMobileDevice?"mobile":"web",products:e?.products},o=await fetch(`https://api.gentooai.com/chat/api/v1/beacon/track/${this.partnerId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return await o.json()}catch(e){console.error(`Error while calling logEvent API: ${e}`)}}async getPartnerId(e){try{const t=`https://api.gentooai.com/app/api/partner/v1/cafe24/mall/${e}`,o=await fetch(t,{method:"GET",headers:{}});return(await o.json()).partnerId}catch(e){console.error(`Error while calling getPartnerId API: ${e}`)}}getProductNo(e=window.location.href){const t=new URL(e),o=t.pathname;"/"===o||"/index.html"===o||""===o.replace(/\/$/,"")?this.displayLocation="HOME":!o.includes("/product")||o.includes("/product/list")||o.includes("/search")?o.includes("/category")||o.includes("/product/list")?this.displayLocation="PRODUCT_LIST":o.includes("/search")?this.displayLocation="PRODUCT_SEARCH":this.displayLocation="UNDEFINED_LOCATION":this.displayLocation="PRODUCT_DETAIL";try{const e=t.searchParams.get("product_no");if(e)return e;const i=/^(?:\/[^\/]+)?\/product\/[^\/]+\/([^\/]+)(?:\/category\/[^\/]+\/display\/[^\/]+\/?)?$/,n=/(?:\/category\/(?:[^\/]+\/)*|[?&]cate_no=)(\d+)/,s=o.match(i),r=o.match(n);return{productNo:s?s[1]:null,categoryNo:r?r[1]:null}}catch(e){return console.error("Invalid URL:",e),null}}getSearchKeyword(){const e=new URL(window.location.href).searchParams;return e.get("keyword")||e.get("query")||null}}var o,i,n,s,r;return window.GentooLogger=t,o=window,document,r=(n=o).GentooLogger,n.GentooLogger=((s=function(){s.q.push(Array.from(arguments)),function(){for(;n.GentooLogger.q&&n.GentooLogger.q.length;){var e=n.GentooLogger.q.shift();n.GentooLogger.process(e)}}()}).q=s.q||[],s.process=function(e){var o=e[0],n=e[1]||{};if("boot"!==o)i?"init"===o?"function"==typeof i.init&&Promise.resolve(i.init(n)).catch((e=>{console.error("Failed to initialize GentooLogger:",e)})):console.error("GentooLogger: Unknown method",o):console.error("GentooLogger: Must call boot() before using this method");else try{i=new t(n)}catch(e){console.error("Failed to create GentooLogger instance:",e)}},s),r&&r.q&&r.q.forEach((function(e){n.GentooLogger.process(e)})),GentooLogger("boot",{partnerType:"cafe24"}),GentooLogger("init",{}),{}})()));
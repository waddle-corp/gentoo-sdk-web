!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["gentoo-logger"]=t():e["gentoo-logger"]=t()}(self,(()=>(()=>{"use strict";var e,t,o,n,i;async function s(e,t={},o={}){const n={event:e,timestamp:Date.now(),...t,...o},i=`${process.env.API_TRACKER_BASE_URL}${process.env.API_USEREVENT_ENDPOINT}`;navigator.sendBeacon(i,JSON.stringify(n))}class r{constructor(e){null===window.__GentooLoggerInited||void 0===window.__GentooLoggerInited?(this.partnerType=e.partnerType||"gentoo",this.gentooSessionData=JSON.parse(sessionStorage.getItem("gentoo"))||{},this.chatUserId=this.gentooSessionData?.cuid||null,this.displayLocation,this.isMobileDevice=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),this.isInitialized=!1,this.itemId=this.getProductNo()?.productNo,this.categoryId=this.getProductNo()?.categoryNo,this.searchKeyword=this.getSearchKeyword(),this.cafe24UserId=null,this.cafe24MemberId=null,this.cafe24GuestId=null,this.sessionId=this.gentooSessionData?.sessionId||`sess-${Date.now()}-${Math.random().toString(36).substring(2,10)}`,this.gentooSessionData?.sessionId||(this.gentooSessionData.sessionId=this.sessionId,sessionStorage.setItem("gentoo",JSON.stringify(this.gentooSessionData))),this.cafe24ClientId="QfNlFJBPD6mXVWkE8MybWD",this.cafe24Version="2024-09-01",this.bootPromise=new Promise(((e,t)=>{(e=>{this.cafe24API=e,this.getPartnerId(e.MALL_ID).then((t=>(this.partnerId=t,new Promise(((t,o)=>{e.getCustomerIDInfo(((e,n)=>{e?(console.error(`Error while calling cafe24 getCustomerIDInfo api: ${e}`),o(e)):t(n)}))}))))).then((e=>(e.id.member_id?(this.cafe24UserId=e.id.member_id,this.cafe24MemberId=e.id.member_id):(this.cafe24UserId=e.id.guest_id,this.cafe24GuestId=e.id.guest_id),async function(e,t="",o,n){const i=e&&"null"!==e?String(e):Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),s={externalKey:String(o),userToken:i,udid:String(t),chatUserId:n?String(n):null};try{const e=`${process.env.API_CHAT_BASE_URL}${process.env.API_AUTH_CAFE24_ENDPOINT}`,t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});return(await t.json()).chatUserId}catch(e){console.error(`Error while calling postChatUserId API: ${e}`)}}(this.cafe24UserId,"",this.partnerId,this.chatUserId)))).then((e=>{this.chatUserId=e,this.gentooSessionData.cuid=e,sessionStorage.setItem("gentoo",JSON.stringify(this.gentooSessionData)),this.basicPayload={sessionId:this.sessionId,externalKey:this.partnerId,chatUserId:this.chatUserId,userId:this.cafe24MemberId,anonymousId:this.cafe24GuestId,displayLocation:this.displayLocation,pageLocation:window.location.href,itemId:this.itemId,categoryId:this.categoryId};const t=document.referrer;t&&!t.includes(window.location.host)?s("PageTransition",this.basicPayload,{referrerOrigin:t}):this.searchKeyword?s("PageTransition",this.basicPayload,{searchKeyword:this.searchKeyword}):s("PageTransition",this.basicPayload),window.GentooLogListener={log:e=>{"floatingEvent"===e.type&&s(e.event,this.basicPayload,{floatingMessage:e.floatingMessage}),"healthCheck"===e.type&&s(e.event,this.basicPayload,{connectionId:e.connectionId})}}})).catch((e=>{console.error("Initialization error:",e),t(e)}))})(CAFE24API.init({client_id:this.cafe24ClientId,version:this.cafe24Version})),(()=>{const e=function(e,t=1e3){let o=0;return(...n)=>{const i=Date.now();i-o>=t&&(o=i,e(...n))}}((()=>{const e=window.scrollY||document.documentElement.scrollTop;s("Scroll",this.basicPayload,{scrollTop:e,documentHeight:document.documentElement.scrollHeight,viewportHeight:window.innerHeight,scrollPercentage:(e/(document.documentElement.scrollHeight-window.innerHeight)*100).toFixed(1)})}));window.addEventListener("scroll",e,{passive:!0}),window.GentooCleanup=()=>{window.removeEventListener("scroll",e)}})()})),window.__GentooLoggerInited="created"):console.warn("GentooLogger already exists in the document, skipping initialization.")}async init(){if(null===window.__GentooLoggerInited||void 0===window.__GentooLoggerInited){try{if(await this.bootPromise,this.isInitialized)return void console.warn("GentooLogger is already initialized");if(!this.chatUserId)throw new Error("Required data not yet loaded");this.isInitialized=!0}catch(e){throw console.error("Failed to initialize:",e),e}window.__GentooLoggerInited="init"}else console.warn("GentooIO init called twice, skipping second call.")}async logEvent(e){try{const t={eventCategory:String(e.eventCategory),chatUserId:String(e.chatUserId),partnerId:String(e.partnerId),channelId:this.isMobileDevice?"mobile":"web",products:e?.products},o=await fetch(`${process.env.API_CHAT_BASE_URL}${process.env.API_USEREVENT_ENDPOINT}/${this.partnerId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return await o.json()}catch(e){console.error(`Error while calling logEvent API: ${e}`)}}async getPartnerId(e){try{const t=`${process.env.API_MAIN_BASE_URL}${process.env.API_PARTNERID_ENDPOINT}/${e}`,o=await fetch(t,{method:"GET",headers:{}});return(await o.json()).partnerId}catch(e){console.error(`Error while calling getPartnerId API: ${e}`)}}getProductNo(e=window.location.href){const t=new URL(e),o=t.pathname;"/"===o||"/index.html"===o||""===o.replace(/\/$/,"")?this.displayLocation="HOME":!o.includes("/product")||o.includes("/product/list")||o.includes("/search")?o.includes("/category")||o.includes("/product/list")?this.displayLocation="PRODUCT_LIST":o.includes("/search")?this.displayLocation="PRODUCT_SEARCH":this.displayLocation="UNDEFINED_LOCATION":this.displayLocation="PRODUCT_DETAIL";try{const e=t.searchParams.get("product_no");if(e)return e;const n=/^(?:\/[^\/]+)?\/product\/[^\/]+\/([^\/]+)(?:\/category\/[^\/]+\/display\/[^\/]+\/?)?$/,i=/(?:\/category\/(?:[^\/]+\/)*|[?&]cate_no=)(\d+)/,s=o.match(n),r=o.match(i);return{productNo:s?s[1]:null,categoryNo:r?r[1]:null}}catch(e){return console.error("Invalid URL:",e),null}}getSearchKeyword(){const e=new URL(window.location.href).searchParams;return e.get("keyword")||e.get("query")||null}}return window.GentooLogger=r,e=window,document,i=(o=e).GentooLogger,o.GentooLogger=((n=function(){n.q.push(Array.from(arguments)),function(){for(;o.GentooLogger.q&&o.GentooLogger.q.length;){var e=o.GentooLogger.q.shift();o.GentooLogger.process(e)}}()}).q=n.q||[],n.process=function(e){var o=e[0],n=e[1]||{};if("boot"!==o)t?"init"===o?"function"==typeof t.init&&Promise.resolve(t.init(n)).catch((e=>{console.error("Failed to initialize GentooLogger:",e)})):console.error("GentooLogger: Unknown method",o):console.error("GentooLogger: Must call boot() before using this method");else try{t=new r(n)}catch(e){console.error("Failed to create GentooLogger instance:",e)}},n),i&&i.q&&i.q.forEach((function(e){o.GentooLogger.process(e)})),GentooLogger("boot",{partnerType:"cafe24"}),GentooLogger("init",{}),{}})()));